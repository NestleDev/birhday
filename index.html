<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="wrapper">
        <div class="maincontent">
            <div class="screen screen_bg_gradient">
                <div class="screen__logo animate__fadeInUp">
                    <img src="./happy-birthday.png" alt="logo" class="logo">
                </div>
                <p class="screen__text text-animate">Lorem ipsum dolor sit amet consectetur adipisicing elit. Reprehenderit aperiam amet ipsum quaerat ipsa doloremque excepturi, beatae eos consectetur, neque deserunt tenetur, id laborum sit molestias dolor distinctio laboriosam fuga.</p>
                <div class="arrow">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="screen screen_absolute screen_bg_question screen_question">
                <div class="screen__content">
                    <div class="screen__title center">Уххх... Ну что, понеслась ?</div>
                    <img class="screen__emmo" src="./emo-2.png" alt="">
                    <button class="button" data-to="question-1">Жми меня!</button>
                </div>
            </div>
            <div class="screen screen_absolute screen_question screen_bg_1 screen_question" id="question-1">
                <div class="screen__content">
                    <div class="screen__title center">Первые кода найдешь у дурака...</div>
                    <input type="number" style="width: 250px;" placeholder="Код..." data-key="2323" data-to="question-2">
                </div>
            </div>
            <div class="screen screen_absolute screen_bg_2 screen_question" id="question-2">
                <div class="screen__content">
                    <div class="screen__title center">Название этого бренда ???</div>
                    <div class="screen__images">
                        <img class="screen__emmo" src="./auto.png" alt="">&nbsp;
                        <img class="screen__emmo" src="./plus.png" alt="">&nbsp;
                        <img class="screen__emmo" src="./circle.png" alt="">
                        <img class="screen__emmo" src="./circle.png" alt="">
                        <img class="screen__emmo" src="./circle.png" alt="">
                        <img class="screen__emmo" src="./circle.png" alt="">
                    </div>
                    <input type="text" style="width: 250px;" placeholder="Ответ..." data-key="2323" data-to="question-3">
                </div>
            </div>
            <div class="screen screen_absolute screen_bg_3 screen_question" id="question-3">
                <div class="screen__content">
                    <div class="screen__title center">Пойди туда - не знаю куда...</div>
                    <input type="number" style="width: 250px;" placeholder="Код..." data-key="2323" data-to="question-4">
                </div>
            </div>
            <div class="screen screen_absolute screen_bg_4 screen_question" id="question-4">
                <div class="screen__content">
                    <div class="screen__title center">Формула всего ...</div>
                    <div class="screen__images">
                       (
                        <img class="screen__emmo" src="./ice.png" alt="">&nbsp; + &nbsp;
                      
                        <img class="screen__emmo" src="./fire.png" alt="">)&nbsp; + &nbsp;
                       
                        <img class="screen__emmo" src="./tea.png" alt="">&nbsp; = &nbsp;?
                    </div>
                    <input type="number" style="width: 250px;" placeholder="Код..." data-key="2323" data-to="question-5">
                </div>
            </div>
            <div class="screen screen_absolute screen_bg_5 screen_question" id="question-5">
                <div class="screen__content">
                    <div class="screen__title center">Черный, а не уголь.<br>
                        Сладкий, а не сахар.<br>
                        Тает, а не снег.</div>
                    <!-- <img class="screen__emmo" src="./emo-1.png" alt=""> -->
                    <input type="number" style="width: 250px;" placeholder="Код..." data-key="2323" data-to="question-6">
                </div>
            </div>
            <div class="screen screen_absolute screen_bg_6 screen_question" id="question-6">
                <div class="screen__content">
                    <div class="screen__title center">Слова из фильма...</div>
                    <img style="width: 230px;" class="screen__emmo" id="audio-play" src="./museum.png" alt="">
                    <audio id="audio1" src="./audio.mp3"></audio>
                    <input type="number" style="width: 250px;" placeholder="Ответ..." data-key="2323" data-to="question-7">

                </div>
            </div>
            <div class="screen screen_absolute screen_bg_7 screen_question" id="question-7">
                <div class="screen__content">
                    <div class="screen__title center">Время тёплых слов</div>
                    <!-- <img class="screen__emmo" src="./emo-1.png" alt=""> -->
                    <input type="number" style="width: 250px;" placeholder="Код..." data-key="2323" data-to="question-8">
                </div>
            </div>
            <div class="screen screen_absolute screen_question screen_prize" id="question-8">
               <div class="prize">
                   <div class="prize__preview">
                    <img class="prize__icon animate__bounce" src="./prize.png" alt="">
                       <div class="prize__input">
                            <input type="number" placeholder="Код..." data-type="prize">
                       </div>
                   </div>
                   <div class="prize__content"></div>
               </div>
               <div class="prize">
                    <div class="prize__preview">
                        <img  class="prize__icon animate__bounce-2" src="./prize.png" alt="">
                        <div class="prize__input">
                            <input type="number" placeholder="Код..." data-type="prize">
                        </div>
                    </div>
                    <div class="prize__content"></div>
               </div>
               <div class="prize">
                    <div class="prize__preview">
                        <img class="prize__icon animate__bounce-1" src="./prize.png" alt="">
                        <div class="prize__input">
                            <input type="number" placeholder="Код..." data-type="prize">
                        </div>
                    </div>
                    <div class="prize__content"></div>
               </div>
               <div class="prize">
                    <div class="prize__preview">
                        <img class="prize__icon animate__bounce-3" src="./prize.png" alt="">
                        <div class="prize__input">
                            <input type="number" placeholder="Код..." data-type="prize">
                        </div>
                    </div>
                    <div class="prize__content"></div>
               </div>
            </div>
            <div class="screen screen_absolute screen_question screen_bg_8" id="question-9">
                <div class="screen__content">
                    <div class="screen__title center">С ДНЁМ РОЖДЕНИЯ!!!</div>
                     <img class="screen__emmo" src="./kiss.png" alt="">
                     <span></span>
                </div>
            </div>
        </div>
    </div>
    <audio id="audio2" src="./tin.mp3"></audio>
    <div class="preloader">
        <div class="preloader__content">
            <img src="./gift-light.svg" alt="" class="preloader__icon">
            <span class="preloader__text">Загружаюсь...</span>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
    <script>
        var textWrapper = document.querySelector('.text-animate');
        var posTouch = null;
        var audio1 = document.querySelector('#audio1');
        var audio2 = document.querySelector('#audio2');
        var preloader = document.querySelector('.preloader')
        var mapPrizes = {
            '236589': {
                type: 'pandora',
                title: 'Браслет "Пандора"',
                grcode: true
            },
            '864599': {
                type: 'sea', 
                title: '5 ночей на берегу моря'
            },
            '446578': {
                type: 'tatu',
                title: 'Tattoo'
            },
            '127688': {
                type: 'paint',
                title: 'Набор для рисования'
            },
            '925417': {
                type: 'helecopt',
                title: 'Прогулка на вертолете по Киеву'
            },
            '421783': {
                type: 'photoset',
                title: 'Фотосет'
            },
            '457982': {
                type: 'print',
                title: 'Карманный фотопринтер'
            },
            '336894': {
                type: 'kigurumi',
                title: 'Кигуруми'
            },
            '444685': {
                type: 'mish',
                title: 'Большой плюшевый медведь'
            },
            '345589': {
                type: 'shop',
                title: 'Шопинг'
            },

        }

        setTimeout(() => {
            preloader.style.opacity = 0;
            preloader.style.transform = `scale(1.5)`;
            setTimeout(() => {
                preloader.style.display = 'none'
                preloader.style.opacity = 1;
                preloader.style.transform = `scale(1)`;
            }, 500)
            textWrapper.innerHTML = textWrapper.textContent.replace(/\S/g, "<span class='letter'>$&</span>");

            anime.timeline().add({
                targets: '.text-animate .letter',
                translateY: ["1.1em", 0],
                translateZ: 0,
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 1000,
                delay: (el, i) => 15 * (i+1)
            });

            setTimeout(() => {
                document.querySelector('.arrow').style.display = 'block';
            }, 3200)
        }, 3000)
        
        document.querySelector('.screen').addEventListener('touchmove', (e) => {
           document.querySelector('.screen_question').style.left = 0;
        })

        document.querySelector('[data-to]').addEventListener('click', (e) => {
           document.querySelector(`#${e.target.dataset.to}`).style.left = 0;
        })

        document.querySelector('#audio-play').addEventListener('touchend', () => {
           if (audio1.paused) {
                audio1.play()
           } else {
               audio1.pause()
           }
        })

        function renderPrize(data) {
            return (`
                <div class="prize-box prize-box--${data.type}" style="background-image: url('./${data.type}.jpg')">
                    <div class="prize-box__content">
                        <div class="prize-box__title">${data.title}</div>
                    </div>
                </div>
            `)
        }

        document.addEventListener('input', (e) => {
            if (e.target.dataset.type === 'prize') {
                var code = e.target.value;
                var prize = mapPrizes[code];
                var container = e.target.closest('.prize').querySelector('.prize__content')

                if (prize) {
                    if ('default' in e.target.dataset) {
                        prize = mapPrizes['864599']
                    }

                    container.innerHTML = renderPrize(prize);
                    container.style.top = 0;
                    delete mapPrizes[code];
                }
            } else {
                const key = e.target.dataset.key

                if (key === e.target.value) {
                    e.target.blur()

                    if (e.target.dataset.to === 'question-8') {
                        preloader.style.backgroundImage = `url('./photo-7.jpg')`;
                        preloader.style.display = 'flex';
                        preloader.querySelector('.preloader__text').textContent = 'Загрузка подарков...';
                        document.querySelector(`#${e.target.dataset.to}`).style.left = 0;
                        setTimeout(() => {
                            preloader.style.opacity = 0;
                            preloader.style.transform = `scale(1.5)`;
                            setTimeout(() => {
                                preloader.style.display = 'none'
                                preloader.style.opacity = 1;
                                preloader.style.transform = `scale(1)`;
                            }, 500)
                        }, 3500)
                    } else {
                        document.querySelector(`#${e.target.dataset.to}`).style.left = 0;
                    }
                }
            }
        })

        document.querySelectorAll('.prize__content').forEach((prize) => {
            var timer;
            var endhand = () => {
                prize.firstElementChild.classList.remove('prize-box--accept')
                clearTimeout(timer)
            }
            
            prize.addEventListener('touchstart', () => {
                prize.firstElementChild.classList.add('prize-box--accept')
                timer = setTimeout(() => {
                    prize.removeEventListener('touchend', endhand)
                    audio2.play()
                    prize.parentNode.innerHTML += `<div class="success-checkmark">
                        <div class="check-icon">
                            <span class="icon-line line-tip"></span>
                            <span class="icon-line line-long"></span>
                            <div class="icon-circle"></div>
                            <div class="icon-fix"></div>
                        </div>
                    </div>`;
                    setTimeout(() => {
                        document.querySelector(`#question-9`).style.left = 0;
                    }, 3000)
                    
                }, 3000)
            })

            prize.addEventListener('touchend', endhand)
        })
    </script>
</body>
</html>